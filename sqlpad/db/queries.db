{"name":"select.sql","tags":[""],"connectionId":"prbmEt7Ibs6ouDHw","queryText":"select \n  contratos.numero_contrato,\n  inscricoes.tipo_plano,\n  inscricoes.parcelas,\n  count(DISTINCT matricula_id) as alunos,\n  case \n  when inscricoes.tipo_plano = 'com_desconto' then SUM(anuidades.valor_desconto) \n  when inscricoes.tipo_plano != 'com_desconto' then SUM(anuidades.valor)\n  end as valor_anuidade,\n  minhas_parcelas.valor_parcelas,\n  minhas_parcelas.desconto_parcelas,\n  minhas_parcelas.multa_parcelas,\n  minhas_parcelas.total_parcelas,\n  minhas_parcelas.qtd_parcelas\nfrom inscricoes\n  join contratos on contratos.id = inscricoes.contrato_id\n  join contratantes on contratantes.id = contratos.contratante_id\n  join turmas on turmas.id = inscricoes.turma_id AND turmas.ano = inscricoes.ano\n  join anuidades on anuidades.ensino = turmas.ensino AND anuidades.curso = turmas.curso AND anuidades.ano = turmas.ano\n  LEFT join (select\n      parcela_contratos.contrato_id as contrato_id,\n      SUM(parcelas.valor) as valor_parcelas,\n      SUM(parcelas.desconto) as desconto_parcelas,\n      SUM(parcelas.multa) as multa_parcelas,\n      SUM(parcelas.total) as total_parcelas,\n      count(DISTINCT parcelas.id) qtd_parcelas\n      from parcela_contratos\n      join parcelas on parcelas.id = parcela_id\n      where parcelas.ano = 2016 AND parcelas.current = 1\n      group by parcela_contratos.contrato_id) AS minhas_parcelas on minhas_parcelas.contrato_id = inscricoes.contrato_id\nwhere\n  inscricoes.ano = 2016\n  AND turmas.ensino != 'PFC' AND turmas.ensino != 'Integral'AND turmas.ensino != 'Estendido'\n  AND contratos.tipo = 0 AND inscricoes.ativa = true \n  \ngroup by contratos.numero_contrato, inscricoes.tipo_plano, inscricoes.parcelas, \n  minhas_parcelas.valor_parcelas, minhas_parcelas.desconto_parcelas, \n  minhas_parcelas.multa_parcelas, minhas_parcelas.total_parcelas,\n  minhas_parcelas.qtd_parcelas\norder by valor_anuidade DESC","chartConfiguration":{"chartType":""},"modifiedDate":{"$$date":1454199151677},"modifiedBy":"bmi.machado@gmail.com","lastAccessedDate":{"$$date":1454199151677},"createdDate":{"$$date":1454199139231},"createdBy":"bmi.machado@gmail.com","_id":"xB98WoqiVziTgMuF"}
{"name":"select_0.sql","tags":[""],"connectionId":"prbmEt7Ibs6ouDHw","queryText":"select \n      inscricoes.tipo_plano,\n      inscricoes.parcelas,\n      count(DISTINCT contratos.numero_contrato) as quantidade_contratos,\n      case \n      when inscricoes.tipo_plano = 'com_desconto' then SUM(anuidades.valor_desconto) \n      when inscricoes.tipo_plano != 'com_desconto' then SUM(anuidades.valor)\n      end as valor_anuidade -- ,\n      -- SUM(minhas_parcelas.valor_parcelas) as valor_parcelas,\n      -- SUM(minhas_parcelas.desconto_parcelas) as desconto_parcelas,\n      -- SUM(minhas_parcelas.multa_parcelas) as multa_parcelas,\n      -- SUM(minhas_parcelas.total_parcelas) as total_parcelas\nfrom inscricoes\n    join contratos on contratos.id = inscricoes.contrato_id\n    join contratantes on contratantes.id = contratos.contratante_id\n    join turmas on turmas.id = inscricoes.turma_id\n    join anuidades on anuidades.ensino = turmas.ensino AND anuidades.curso = turmas.curso AND anuidades.ano = turmas.ano\n    -- LEFT join (select\n      -- parcela_contratos.contrato_id as contrato_id,\n      -- SUM(parcelas.valor) as valor_parcelas,\n      -- SUM(parcelas.desconto) as desconto_parcelas,\n      -- SUM(parcelas.multa) as multa_parcelas,\n      -- SUM(parcelas.total) as total_parcelas,\n      -- count(DISTINCT parcelas.id) qtd_parcelas\n      -- from parcela_contratos\n      -- join parcelas on parcelas.id = parcela_id\n      -- where parcelas.ano = 2016\n      -- group by parcela_contratos.contrato_id) AS minhas_parcelas on minhas_parcelas.contrato_id = inscricoes.contrato_id\nwhere \n    inscricoes.ano = 2015 AND turmas.ensino != 'PFC' AND turmas.ensino != 'Integral'AND turmas.ensino != 'Estendido'\n    AND contratos.tipo = 0 AND inscricoes.ativa = true\n\n    group by inscricoes.tipo_plano, inscricoes.parcelas\n    order by valor_anuidade","chartConfiguration":{"chartType":""},"modifiedDate":{"$$date":1454198361112},"modifiedBy":"bmi.machado@gmail.com","lastAccessedDate":{"$$date":1454198361112},"createdDate":{"$$date":1454189198712},"createdBy":"bmi.machado@gmail.com","_id":"ygrKtuIaurim1wst"}
